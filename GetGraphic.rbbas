#tag ModuleProtected Module GetGraphic	#tag Method, Flags = &h0		Function getPictFromURL(theURL as string) As picture		  'getPictFromURL is an Image download method. Which obtains a picture given a URL.           		  'handles a single level redirects to .com sites.		  'returns a picture or nil		  '		  'the following external items are also needed		  'theSocket is an httpsocket		  		  'app.tempFile is a global folderItem in this implementation for reasons other than the this particular method's needs,		  'but could also be rewritten as a local item		  'cBrowserAgent is a string constant equal to a known browser's agent string		  'cMaxHTTPwaitSeconds is a numeric constant with maximum wait time you wish to allow		  		  dim theStr, redirectURL as string		  dim gotFile as Boolean		  dim p as picture		  dim prefix as string		  dim nPos as integer		  Dim tempFile As FolderItem		  Dim theSocket as HTTPSocket = new HTTPSocket		  tempFile = new folderitem		  tempfile = specialfolder.temporary.child("temp.jpg")		  if tempFile <> nil then		    		    'load url targetfile using httpsocket in synchronous mode		    theSocket.Yield = false		    gotFile = theSocket.get(theURL, tempFile, 0)		    if theSocket.HTTPStatusCode = 302 then		      redirectURL = theSocket.PageHeaders.Value("Location")		      'see if redirectURL needs prefix		      if instr(redirectURL, "http:") = 0 then		        nPos = instr(theURL, ".com")		        prefix = left(theURL, nPos) + "com"		        redirectURL = prefix + redirectURL		      end		      		      gotFile = theSocket.get(redirectURL,tempFile, 0)		    end if		    		    if gotFile then		      p = tempfile.OpenAsPicture		      return p		    end		  end		  		End Function	#tag EndMethod	#tag ViewBehavior		#tag ViewProperty			Name="Index"			Visible=true			Group="ID"			InitialValue="-2147483648"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Left"			Visible=true			Group="Position"			InitialValue="0"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Name"			Visible=true			Group="ID"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Super"			Visible=true			Group="ID"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Top"			Visible=true			Group="Position"			InitialValue="0"			InheritedFrom="Object"		#tag EndViewProperty	#tag EndViewBehaviorEnd Module#tag EndModule